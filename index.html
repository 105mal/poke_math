<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒã‚±ãƒ¢ãƒ³ãŸã—ã–ã‚“ã‚²ãƒ¼ãƒ </title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to bottom, #fffaf0, #ffe4e1);
            text-align: center;
            color: #ff1493;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .pokemon-image {
            width: 120px;
            height: 120px;
            cursor: pointer;
            margin: 10px;
        }
        .number-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .number {
            font-size: 3em;
            color: #ff69b4;
        }
        .button, .answer-button {
            font-size: 1.5em;
            padding: 15px 30px;
            margin: 15px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        .button {
            background-color: #ff66b2;
        }
        .button:hover {
            background-color: #ff3399;
            transform: scale(1.05);
        }
        .answer-button {
            background-color: #ffb6c1;
        }
        .answer-button:hover {
            background-color: #ff91a4;
            transform: scale(1.05);
        }
        .correct {
            background-color: #32CD32 !important;
            color: white;
        }
        .incorrect {
            background-color: #FF4500 !important;
            color: white;
        }
        .hidden {
            display: none;
        }
        /* ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤º */
        #points-display {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
            color: #ff1493;
        }
        /* ã‚¿ã‚¤ãƒ—ã®è‰²è¨­å®šï¼ˆç™½æŠœãï¼‰ */
        .type {
            font-size: 1.2em;
            margin-right: 5px;
            padding: 5px 10px;
            border-radius: 5px;
            color: white;
        }
        .type.normal { background-color: #A8A878; }
        .type.fire { background-color: #F08030; }
        .type.water { background-color: #6890F0; }
        .type.electric { background-color: #F8D030; }
        .type.grass { background-color: #78C850; }
        .type.ice { background-color: #98D8D8; }
        .type.fighting { background-color: #C03028; }
        .type.poison { background-color: #A040A0; }
        .type.ground { background-color: #E0C068; }
        .type.flying { background-color: #A890F0; }
        .type.psychic { background-color: #F85888; }
        .type.bug { background-color: #A8B820; }
        .type.rock { background-color: #B8A038; }
        .type.ghost { background-color: #705898; }
        .type.dragon { background-color: #7038F8; }
        .type.dark { background-color: #705848; }
        .type.steel { background-color: #B8B8D0; }
        .type.fairy { background-color: #EE99AC; }
        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®šç¾© */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-30px);
            }
            60% {
                transform: translateY(-15px);
            }
        }
        @keyframes shake {
            0% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
            100% { transform: translateX(0); }
        }
        .bounce {
            animation: bounce 0.5s;
        }
        .shake {
            animation: shake 0.5s;
        }
        /* ãƒã‚¹ã‚¿ãƒ¼ãƒœãƒ¼ãƒ«ç”»åƒ */
        #master-ball {
            width: 100px;
            height: 100px;
            margin: 10px auto;
            display: block;
        }
        /* ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚º */
        #tutorial p {
            font-size: 1.8em;
        }
    </style>
</head>
<body>
    <!-- ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤º -->
    <div id="points-display">
        ãƒã‚¤ãƒ³ãƒˆ: <span id="points">0</span>
    </div>

    <!-- ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç”»é¢ -->
    <div id="story">
        <h2>ãƒã‚±ãƒ¢ãƒ³ãŸã—ã–ã‚“ã‚²ãƒ¼ãƒ </h2>
        <img id="monster-ball" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png" alt="ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãƒœãƒ¼ãƒ«" style="display:block; margin:0 auto;">
        <p>ã“ã‚“ã«ã¡ã¯ï¼ãƒã‚±ãƒ¢ãƒ³ã¨ã„ã£ã—ã‚‡ã«ãŸã—ã–ã‚“ã‚’ã¾ãªã¼ã†ï¼</p>
        <button class="button" onclick="beginAdventure()">ã¯ã˜ã‚ã‚‹</button>
    </div>

    <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é¸æŠç”»é¢ -->
    <div id="character-select" class="hidden">
        <h2>ã™ããªãƒã‚±ãƒ¢ãƒ³ã‚’ãˆã‚‰ã¼ã†ï¼</h2>
        <div class="pokemon-list" id="pokemon-list">
            <!-- ã“ã“ã«ãƒã‚±ãƒ¢ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </div>
    </div>

    <!-- ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç”»é¢ -->
    <div id="tutorial" class="hidden">
        <p>ãŸãã•ã‚“ ã›ã„ã‹ã„ã™ã‚‹ã¨ ã¨ãã¹ã¤ãªãƒã‚±ãƒ¢ãƒ³ãŒ ã‚‚ã‚‰ãˆã‚‹ã‚ˆï¼</p>
        <img id="master-ball" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/master-ball.png" alt="ãƒã‚¹ã‚¿ãƒ¼ãƒœãƒ¼ãƒ«">
        <button class="button" onclick="startGameAfterTutorial()">ã¯ã˜ã‚ã‚‹</button>
    </div>

    <!-- ã‚²ãƒ¼ãƒ ç”»é¢ -->
    <div id="game" class="hidden">
        <div id="special-reward-message" class="hidden" style="color: #ff1493; font-size: 2em; margin-bottom: 10px;">ã›ã„ã‹ã„ã§ ã¨ãã¹ã¤ãªãƒã‚±ãƒ¢ãƒ³ãŒ ã‚‚ã‚‰ãˆã‚‹ï¼</div>
        <div class="number-container">
            <div id="number1" class="number"></div>
            <div id="plus">+</div>
            <div id="number2" class="number"></div>
            <div id="equals">=</div>
            <div id="result" class="number">?</div>
        </div>
    </div>

    <!-- ç­”ãˆã®ãƒœã‚¿ãƒ³ -->
    <div id="answers" class="hidden">
        <button class="answer-button" onclick="checkAnswer(0)"></button>
        <button class="answer-button" onclick="checkAnswer(1)"></button>
        <button class="answer-button" onclick="checkAnswer(2)"></button>
        <button class="answer-button" onclick="checkAnswer(3)"></button>
    </div>

    <!-- æ–°ã—ã„å•é¡Œãƒœã‚¿ãƒ³ -->
    <button id="new-problem-button" class="button hidden" onclick="generateNewProblem()">ã‚ãŸã‚‰ã—ã„ã‚‚ã‚“ã ã„ã¸</button>

    <!-- çµæœç”»é¢ -->
    <div id="result-screen" class="hidden">
        <div id="result-message" style="font-size: 3em; margin-top: 20px;"></div>
        <img id="result-pokemon" src="" alt="ã½ã‘ã‚‚ã‚“" class="pokemon-image hidden">
        <div id="pokemon-name" style="font-size: 1.8em; margin-top: 10px;"></div>
        <div id="pokemon-types" style="margin-top: 5px;"></div>
        <button class="button" onclick="startGame()">ã‚ãŸã‚‰ã—ã„ã‚‚ã‚“ã ã„ã¸</button>
    </div>

    <script>
        const pokemonApiUrl = 'https://pokeapi.co/api/v2/pokemon/';
        const maxPokemonId = 1010; // æœ€æ–°ã®ãƒã‚±ãƒ¢ãƒ³ã®æœ€å¤§IDã‚’è¨­å®šï¼ˆä¾‹ï¼šã‚¹ã‚«ãƒ¼ãƒ¬ãƒƒãƒˆï¼†ãƒã‚¤ã‚ªãƒ¬ãƒƒãƒˆä¸–ä»£ã¾ã§ï¼‰

        // ä¼èª¬ãŠã‚ˆã³å¹»ã®ãƒã‚±ãƒ¢ãƒ³ã®IDãƒªã‚¹ãƒˆ
        const legendaryAndMythicalPokemonIds = [
            144, 145, 146, 150, 151, 249, 250, 251,  // åˆä»£ã€œã‚¸ãƒ§ã‚¦ãƒˆåœ°æ–¹
            377, 378, 379, 380, 381, 382, 383, 384, 385, // ãƒ›ã‚¦ã‚¨ãƒ³åœ°æ–¹
            480, 481, 482, 483, 484, 485, 486, 487, 488, 489, 490, 491, 492, 493, // ã‚·ãƒ³ã‚ªã‚¦åœ°æ–¹
            638, 639, 640, 641, 642, 643, 644, 645, 646, 647, 648, 649, // ã‚¤ãƒƒã‚·ãƒ¥åœ°æ–¹
            716, 717, 718, 719, 720, 721, // ã‚«ãƒ­ã‚¹åœ°æ–¹
            785, 786, 787, 788, 789, 790, 791, 792, 793, 794, 795, 796, 797, 798, 799, 800, 801, 802, 803, 804, 805, 806, 807, // ã‚¢ãƒ­ãƒ¼ãƒ©åœ°æ–¹
            888, 889, 890, 891, 892, 893, 894, 895, 896, 897, 898,  // ã‚¬ãƒ©ãƒ«åœ°æ–¹
            1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, 1009, 1010 // ã‚¹ã‚«ãƒ¼ãƒ¬ãƒƒãƒˆï¼†ãƒã‚¤ã‚ªãƒ¬ãƒƒãƒˆä¸–ä»£
        ];

        // é€šå¸¸ãƒã‚±ãƒ¢ãƒ³ã®IDãƒªã‚¹ãƒˆï¼ˆä¼èª¬ãƒ»å¹»ã‚’é™¤å¤–ï¼‰
        const normalPokemonIds = Array.from({ length: maxPokemonId }, (_, i) => i + 1).filter(id => !legendaryAndMythicalPokemonIds.includes(id));

        let correctAnswer = 0;
        let points = 0;
        let selectedPokemonId = null;

        const starterPokemonGroups = [
            [1, 4, 7], // ã‚«ãƒ³ãƒˆãƒ¼åœ°æ–¹
            [152, 155, 158], // ã‚¸ãƒ§ã‚¦ãƒˆåœ°æ–¹
            [252, 255, 258], // ãƒ›ã‚¦ã‚¨ãƒ³åœ°æ–¹
            [387, 390, 393], // ã‚·ãƒ³ã‚ªã‚¦åœ°æ–¹
            [495, 498, 501], // ã‚¤ãƒƒã‚·ãƒ¥åœ°æ–¹
            [650, 653, 656], // ã‚«ãƒ­ã‚¹åœ°æ–¹
            [722, 725, 728], // ã‚¢ãƒ­ãƒ¼ãƒ©åœ°æ–¹
            [810, 813, 816] // ã‚¬ãƒ©ãƒ«åœ°æ–¹
        ];

        const starterFixedPokemon = [25, 133]; // ãƒ”ã‚«ãƒãƒ¥ã‚¦ã€ã‚¤ãƒ¼ãƒ–ã‚¤

        function getRandomStarterGroup() {
            const randomIndex = Math.floor(Math.random() * starterPokemonGroups.length);
            return starterPokemonGroups[randomIndex];
        }

        function loadStarterPokemon() {
            const randomGroup = getRandomStarterGroup();
            const starters = starterFixedPokemon.concat(randomGroup); // ãƒ”ã‚«ãƒãƒ¥ã‚¦ã¨ã‚¤ãƒ¼ãƒ–ã‚¤ã‚’å›ºå®š
            const pokemonList = document.getElementById('pokemon-list');
            pokemonList.innerHTML = ''; // ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢

            starters.forEach(async (pokemonId) => {
                const pokemonImage = await fetchPokemonImage(pokemonId);
                const imgElement = document.createElement('img');
                imgElement.src = pokemonImage;
                imgElement.alt = `Pokemon ${pokemonId}`;
                imgElement.classList.add('pokemon-image');
                imgElement.onclick = () => selectPokemon(pokemonId);
                pokemonList.appendChild(imgElement);
            });
        }

        // ãƒã‚±ãƒ¢ãƒ³ã®ç”»åƒã‚’å–å¾—
        async function fetchPokemonImage(pokemonId) {
            try {
                const response = await fetch(pokemonApiUrl + pokemonId);
                const data = await response.json();
                return data.sprites.front_default;
            } catch (error) {
                console.error('ãƒã‚±ãƒ¢ãƒ³ç”»åƒã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                return '';
            }
        }

        // ãƒã‚±ãƒ¢ãƒ³ã®æƒ…å ±ã‚’å–å¾—
        async function fetchPokemonInfo(pokemonId) {
            try {
                const response = await fetch(`${pokemonApiUrl}${pokemonId}`);
                const data = await response.json();
                const responseSpecies = await fetch(data.species.url);
                const speciesData = await responseSpecies.json();
                const nameInfo = speciesData.names.find(nameInfo => nameInfo.language.name === 'ja');
                const name = nameInfo ? nameInfo.name : 'ãµã‚ã„';
                const types = data.types.map(typeInfo => {
                    switch (typeInfo.type.name) {
                        case 'normal': return '<span class="type normal">ãƒãƒ¼ãƒãƒ«</span>';
                        case 'fire': return '<span class="type fire">ã»ã®ãŠ</span>';
                        case 'water': return '<span class="type water">ã¿ãš</span>';
                        case 'electric': return '<span class="type electric">ã§ã‚“ã</span>';
                        case 'grass': return '<span class="type grass">ãã•</span>';
                        case 'ice': return '<span class="type ice">ã“ãŠã‚Š</span>';
                        case 'fighting': return '<span class="type fighting">ã‹ãã¨ã†</span>';
                        case 'poison': return '<span class="type poison">ã©ã</span>';
                        case 'ground': return '<span class="type ground">ã˜ã‚ã‚“</span>';
                        case 'flying': return '<span class="type flying">ã²ã“ã†</span>';
                        case 'psychic': return '<span class="type psychic">ã‚¨ã‚¹ãƒ‘ãƒ¼</span>';
                        case 'bug': return '<span class="type bug">ã‚€ã—</span>';
                        case 'rock': return '<span class="type rock">ã„ã‚</span>';
                        case 'ghost': return '<span class="type ghost">ã‚´ãƒ¼ã‚¹ãƒˆ</span>';
                        case 'dragon': return '<span class="type dragon">ãƒ‰ãƒ©ã‚´ãƒ³</span>';
                        case 'dark': return '<span class="type dark">ã‚ã</span>';
                        case 'steel': return '<span class="type steel">ã¯ãŒã­</span>';
                        case 'fairy': return '<span class="type fairy">ãƒ•ã‚§ã‚¢ãƒªãƒ¼</span>';
                        default: return `<span class="type">${typeInfo.type.name}</span>`;
                    }
                }).join(', ');
                return { name, types };
            } catch (error) {
                console.error('ãƒã‚±ãƒ¢ãƒ³æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                return { name: 'ãµã‚ã„', types: 'ãµã‚ã„' };
            }
        }

        // æ–°ã—ã„å•é¡Œã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
        function generateNewProblem() {
            const number1 = getRandomNumber();
            const number2 = getValidSecondNumber(number1);

            document.getElementById('number1').innerText = number1;
            document.getElementById('number2').innerText = number2;
            document.getElementById('result').innerText = '?';

            correctAnswer = number1 + number2;
            const answers = generateAnswers(correctAnswer);
            const answerButtons = document.querySelectorAll('.answer-button');
            resetAnswerButtons(answerButtons);
            answerButtons.forEach((button, index) => {
                button.innerText = answers[index];
            });

            // 100ãƒã‚¤ãƒ³ãƒˆã®å€æ•°ã«é”ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹å ´åˆã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            const specialRewardMessage = document.getElementById('special-reward-message');
            if ((points % 100) >= 90) {
                specialRewardMessage.classList.remove('hidden');
            } else {
                specialRewardMessage.classList.add('hidden');
            }
        }

        // ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°ï¼ˆ1ã‹ã‚‰10ã¾ã§ã®æ•°ï¼‰
        function getRandomNumber() {
            return Math.floor(Math.random() * 10) + 1;
        }

        // 1ã¤ç›®ã®æ•°å€¤ã«åŸºã¥ã„ã¦ã€2ã¤ç›®ã®æ•°å€¤ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
        function getValidSecondNumber(number1) {
            const maxSecondNumber = 10 - number1; // åˆè¨ˆãŒ10ã‚’è¶…ãˆãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®æœ€å¤§å€¤
            return Math.floor(Math.random() * maxSecondNumber) + 1;
        }

        // ç­”ãˆã®å€™è£œã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
        function generateAnswers(correctAnswer) {
            const answers = new Set();
            answers.add(correctAnswer);
            while (answers.size < 4) {
                let randomAnswer = getRandomNumber(); // 1ã‹ã‚‰10ã®ç¯„å›²ã§ç”Ÿæˆ
                if (randomAnswer !== correctAnswer) {
                    answers.add(randomAnswer);
                }
            }
            return Array.from(answers).sort(() => Math.random() - 0.5);
        }

        // ç­”ãˆã®ãƒœã‚¿ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹é–¢æ•°
        function resetAnswerButtons(answerButtons) {
            answerButtons.forEach(button => {
                button.classList.remove('correct', 'incorrect');
                button.classList.add('answer-button');
                button.innerText = ''; // åˆæœŸåŒ–
            });
        }

        // ç­”ãˆã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°
        async function checkAnswer(selectedAnswerIndex) {
            const answerButtons = document.querySelectorAll('.answer-button');
            const selectedValue = parseInt(answerButtons[selectedAnswerIndex].innerText, 10);
            const resultMessage = document.getElementById('result-message');

            console.log(`Selected Answer: ${selectedValue}, Correct Answer: ${correctAnswer}`);

            if (selectedValue === correctAnswer) {
                resultMessage.innerHTML = 'ã€‡<br>ã™ã”ã„ï¼ã›ã„ã‹ã„ã§ã™ï¼';
                answerButtons[selectedAnswerIndex].classList.add('correct');

                // ãƒã‚¤ãƒ³ãƒˆåŠ ç®—
                points += 10;
                document.getElementById('points').innerText = points;
                console.log(`Points updated: ${points}`);

                // æ­£è§£æ™‚ã«çµæœç”»é¢ã«ç§»è¡Œ
                await showResultScreen(true);

                // 100ãƒã‚¤ãƒ³ãƒˆã”ã¨ã«å ±é…¬ã‚’è¡¨ç¤º
                if (points % 100 === 0) {
                    await showRewardScreen();
                }
            } else {
                resultMessage.innerHTML = 'Ã—<br>ã–ã‚“ã­ã‚“ï¼ã¤ãã¯ãŒã‚“ã°ã‚ã†ï¼';
                answerButtons[selectedAnswerIndex].classList.add('incorrect');

                // ä¸æ­£è§£æ™‚ã«çµæœç”»é¢ã«ç§»è¡Œ
                await showResultScreen(false);
            }
        }

        // çµæœç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        async function showResultScreen(isCorrect) {
            toggleVisibility('game', false);
            toggleVisibility('answers', false);
            toggleVisibility('new-problem-button', false);
            toggleVisibility('result-screen', true);

            if (isCorrect) {
                // é€šå¸¸ãƒã‚±ãƒ¢ãƒ³ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠï¼ˆä¼èª¬ã‚„å¹»ã‚’é™¤å¤–ï¼‰
                const resultPokemonId = normalPokemonIds[Math.floor(Math.random() * normalPokemonIds.length)];
                const resultPokemonImage = await fetchPokemonImage(resultPokemonId);
                const resultPokemonInfo = await fetchPokemonInfo(resultPokemonId);

                document.getElementById('result-pokemon').src = resultPokemonImage;
                document.getElementById('result-pokemon').classList.remove('hidden');
                document.getElementById('pokemon-name').innerText = resultPokemonInfo.name;
                document.getElementById('pokemon-types').innerHTML = resultPokemonInfo.types;

                document.getElementById('result-pokemon').classList.add('bounce'); // æ­£è§£æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                setTimeout(() => document.getElementById('result-pokemon').classList.remove('bounce'), 1000);
            } else {
                document.getElementById('result-pokemon').classList.add('hidden');
                document.getElementById('pokemon-name').innerText = '';
                document.getElementById('pokemon-types').innerHTML = '';
            }
        }

        // å ±é…¬ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°ï¼ˆ100ãƒã‚¤ãƒ³ãƒˆç²å¾—æ™‚ï¼‰
        async function showRewardScreen() {
            const legendaryPokemonId = legendaryAndMythicalPokemonIds[Math.floor(Math.random() * legendaryAndMythicalPokemonIds.length)];
            const rewardPokemonImage = await fetchPokemonImage(legendaryPokemonId);
            const rewardPokemonInfo = await fetchPokemonInfo(legendaryPokemonId);

            document.getElementById('result-message').innerHTML = 'ğŸ‰ ã¨ãã¹ã¤ãªãƒã‚±ãƒ¢ãƒ³ã‚’ã¦ã«ã„ã‚ŒãŸï¼ ğŸ‰';
            document.getElementById('result-pokemon').src = rewardPokemonImage;
            document.getElementById('pokemon-name').innerText = rewardPokemonInfo.name;
            document.getElementById('pokemon-types').innerHTML = rewardPokemonInfo.types;

            document.getElementById('result-pokemon').classList.add('bounce');
            setTimeout(() => document.getElementById('result-pokemon').classList.remove('bounce'), 1000);

            console.log(`Reward: ${rewardPokemonInfo.name} appeared!`);
        }

        // ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹é–¢æ•°
        function startGame() {
            toggleVisibility('result-screen', false);
            toggleVisibility('game', true);
            toggleVisibility('answers', true);
            toggleVisibility('new-problem-button', true);
            toggleVisibility('story', false);
            toggleVisibility('tutorial', false);
            toggleVisibility('character-select', false);
            document.getElementById('pokemon-name').innerText = '';
            document.getElementById('pokemon-types').innerText = '';
            generateNewProblem();
        }

        // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å¾Œã«ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹
        function startGameAfterTutorial() {
            toggleVisibility('tutorial', false);
            startGame(); // ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹
        }

        // å¯è¦–æ€§ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°
        function toggleVisibility(elementId, isVisible) {
            const element = document.getElementById(elementId);
            if (element) {
                if (isVisible) {
                    element.classList.remove('hidden');
                } else {
                    element.classList.add('hidden');
                }
            } else {
                console.error(`Element with ID "${elementId}" not found.`);
            }
        }

        // å†’é™ºã®é–‹å§‹ï¼ˆã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç”»é¢ã‚’è¡¨ç¤ºï¼‰
        function beginAdventure() {
            toggleVisibility('story', false);
            toggleVisibility('character-select', true);
            loadStarterPokemon(); // ãƒã‚±ãƒ¢ãƒ³ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚€
        }

        // ãƒã‚±ãƒ¢ãƒ³ã®é¸æŠ
        function selectPokemon(pokemonId) {
            selectedPokemonId = pokemonId;
            toggleVisibility('character-select', false);
            toggleVisibility('tutorial', true);
        }

        // åˆæœŸåŒ–æ™‚ã«ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç”»é¢ã‚’è¡¨ç¤º
        window.onload = () => {
            console.log('Window loaded');
            try {
                toggleVisibility('story', true);
                toggleVisibility('character-select', false);
                toggleVisibility('tutorial', false);
                toggleVisibility('game', false);
                toggleVisibility('answers', false);
                toggleVisibility('new-problem-button', false);
                toggleVisibility('result-screen', false);
                toggleVisibility('points-display', true);
                console.log('ç”»é¢ã®è¡¨ç¤ºã‚’ãã‚Šã‹ãˆã¾ã—ãŸã€‚');
            } catch (error) {
                console.error('åˆæœŸåŒ–ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
            }
        };
    </script>
</body>
</html>
